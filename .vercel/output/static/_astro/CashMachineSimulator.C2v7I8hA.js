import{i as Q,r as At,s as I}from"./attributes.BMDjYIYG.js";import{a as Bt}from"./index-client.BZcNXyfQ.js";import{t as H,g as s,J as O,a as W,F as Ct,G as jt,c as a,H as o,f as z,I as M,s as l,r as e,L as Jt,b as u,z as J,u as c,E as Et,n as Gt}from"./render.e71zp6dr.js";import{e as $s,i as Ys}from"./attributes.Bu9u21_b.js";import{s as As}from"./class.o1nnyBL4.js";import{s as Dt}from"./style.DIYQUsB1.js";import{b as Ot}from"./input.T_F2MOpi.js";import{p as Tt,a as Lt}from"./event-modifiers.BqlTOgs2.js";import{i as Ut}from"./lifecycle.BWefaNsD.js";import{p as Ft}from"./props.C-SnMakD.js";/* empty css                      */const Ht="cash",Pt="Cash Frenzy",Nt=20,Vt=0,qt=[{rewardId:1,amount:1,odds:1,type:"entity",id:null,picture:"thumbnails/jackpot.webp",isBigwin:!0,isSuperJackpot:!0},{rewardId:2,amount:30,odds:42e3,type:"hardcurrency",id:null,picture:"thumbnails/jackpot_gold_x30.webp",isBigwin:!1,isSuperJackpot:!1},{rewardId:3,amount:40,odds:22e3,type:"hardcurrency",id:null,picture:"thumbnails/jackpot_gold_x40.webp",isBigwin:!1,isSuperJackpot:!1},{rewardId:4,amount:50,odds:10400,type:"hardcurrency",id:null,picture:"thumbnails/jackpot_gold_x50.webp",isBigwin:!1,isSuperJackpot:!1},{rewardId:5,amount:80,odds:3900,type:"hardcurrency",id:null,picture:"thumbnails/jackpot_gold_x80.webp",isBigwin:!1,isSuperJackpot:!1},{rewardId:6,amount:100,odds:1300,type:"hardcurrency",id:null,picture:"thumbnails/jackpot_gold_x100.webp",isBigwin:!1,isSuperJackpot:!1},{rewardId:7,amount:200,odds:500,type:"hardcurrency",id:null,picture:"thumbnails/jackpot_gold_x200.webp",isBigwin:!1,isSuperJackpot:!1},{rewardId:8,amount:500,odds:170,type:"hardcurrency",id:null,picture:"thumbnails/jackpot_gold_x500.webp",isBigwin:!1,isSuperJackpot:!1},{rewardId:9,amount:1e3,odds:75,type:"hardcurrency",id:null,picture:"thumbnails/jackpot_gold_x1000.webp",isBigwin:!1,isSuperJackpot:!1},{rewardId:10,amount:2e3,odds:40,type:"hardcurrency",id:null,picture:"thumbnails/jackpot_gold_x2000.webp",isBigwin:!1,isSuperJackpot:!1},{rewardId:11,amount:5e3,odds:10,type:"hardcurrency",id:null,picture:"thumbnails/jackpot_gold_x5000.webp",isBigwin:!1,isSuperJackpot:!1},{rewardId:12,amount:5e4,odds:27e4,type:"softcurrency",id:null,picture:"thumbnails/sc10000.webp",isBigwin:!1,isSuperJackpot:!1}],Kt={id:Ht,title:Pt,cost:Nt,tokenCost:Vt,rewards:qt},es=Kt;function Zs(t=es){return t.rewards.filter(d=>d.odds>0)}function st(t=es){return Zs(t).reduce((d,v)=>d+v.odds,0)}function p(t){return t.toLocaleString("ru-RU")}function tt(t){return t.type==="hardcurrency"?`${p(t.amount)} золота`:t.type==="softcurrency"?`${p(t.amount)} серебра`:t.picture&&t.picture.includes("jackpot")?"Джекпот":"Неизвестная награда"}const Qt=new Set([30,40,50,80,100,200,500,1e3,2e3,5e3]),Xt=new Set([5e4]);function et(t,d){return`/cash/${t}${d}.webp`}function Yt(t){return Qt.has(t)?et("g",t):vs("hardcurrency")}function Zt(t){return Xt.has(t)?et("s",t):vs("softcurrency")}function vs(t){return t==="hardcurrency"?"/cash/hardcurrency.webp":"/cash/softcurrency.webp"}function at(t){return t.type==="hardcurrency"?Yt(t.amount):t.type==="softcurrency"?Zt(t.amount):t.type==="entity"?"/cash/jackpot.webp":"/cash/unknown.webp"}function se(t,d=es){const v=st(d);return v?t.odds/v:0}function te(t,d=es){return{...t,label:tt(t),chance:se(t,d),icon:at(t)}}function ee(t,d,v){const{historySize:m=12}=v,b=Zs(d);if(!b.length)throw new Error("Нет доступных наград для симуляции.");const h=st(d),f=[];let _=0;for(const S of b)_+=S.odds,f.push({reward:S,cumulative:_});const r=m>0?new Array(m):[];return{weightedRewards:f,totalWeight:h,rewardMap:new Map,totalGoldWon:0,totalSilverWon:0,historyBuffer:r,historySize:m,historyCount:0,lastHistoryIndex:-1,baseTimestamp:Date.now()}}function ae(t,d,v,m){const{weightedRewards:b,totalWeight:h}=t,f=m()*h;let _=null;for(const L of b)if(f<=L.cumulative){_=L.reward;break}const r=_??b[b.length-1].reward,S=tt(r),R=at(r);let T=t.rewardMap.get(r.rewardId);if(T||(T={reward:r,label:S,count:0,totalAmount:0,icon:R},t.rewardMap.set(r.rewardId,T)),T.count+=1,T.totalAmount+=r.amount,r.type==="hardcurrency"?t.totalGoldWon+=r.amount:r.type==="softcurrency"&&(t.totalSilverWon+=r.amount),t.historySize>0){const L={reward:r,label:S,timestamp:t.baseTimestamp+v,icon:R},E=v%t.historySize;t.historyBuffer[E]=L,t.lastHistoryIndex=E,t.historyCount<t.historySize&&(t.historyCount+=1)}}function le(t,d){const v=Array.from(t.rewardMap.values()).sort((b,h)=>h.count!==b.count?h.count-b.count:h.totalAmount-b.totalAmount),m=[];for(let b=0;b<t.historyCount;b+=1){const h=(t.lastHistoryIndex-b+t.historySize)%t.historySize,f=t.historyBuffer[h];f&&m.push(f)}return{spins:d,goldWon:t.totalGoldWon,silverWon:t.totalSilverWon,breakdown:v,history:m}}async function ne(t,d=es,v={}){const{randomFn:m=Math.random,batchSize:b=2e3,onProgress:h,signal:f}=v,_=ee(t,d,v);let r=0;for(;r<t;){if(f?.aborted)throw new DOMException("Симуляция остановлена","AbortError");const S=Math.min(r+b,t);for(let R=r;R<S;R+=1)ae(_,d,R,m);r=S,h?.(r,t),r<t&&await new Promise(R=>setTimeout(R))}return le(_,t)}var re=z('<div class="progress svelte-nxslby"><div class="progress-bar svelte-nxslby"><div class="progress-fill svelte-nxslby"></div></div> <div class="progress-label svelte-nxslby"> </div></div>'),oe=z('<p class="error svelte-nxslby"> </p>'),ie=z('<button class="primary show-results-btn svelte-nxslby">Показать результаты</button>'),ce=z('<div class="table-row svelte-nxslby"><span class="reward-label svelte-nxslby"><img class="reward-icon svelte-nxslby" loading="lazy"/> <span class="svelte-nxslby"> </span></span> <span class="svelte-nxslby"> </span> <span class="svelte-nxslby"> </span></div>'),de=z('<p class="empty svelte-nxslby">Запустите симуляцию, чтобы увидеть историю.</p>'),ve=z('<li class="svelte-nxslby"><div class="history-info svelte-nxslby"><img class="history-icon svelte-nxslby" loading="lazy"/> <span class="title"> </span></div> <span class="odds"> </span></li>'),ue=z('<ul class="history svelte-nxslby"></ul>'),pe=z('<div class="modal-overlay svelte-nxslby" role="dialog" tabindex="-1"><div class="modal-content svelte-nxslby"><div class="modal-header svelte-nxslby"><h3 class="svelte-nxslby">Результаты симуляции</h3> <button class="modal-close svelte-nxslby">✕</button></div> <section class="stats svelte-nxslby"><div class="stat-card metric spins svelte-nxslby"><div class="metric-icon svelte-nxslby" aria-hidden="true"><img src="/etc/icon_timer.webp" alt="" loading="lazy" class="svelte-nxslby"/></div> <div class="metric-body svelte-nxslby"><span class="label svelte-nxslby">Прокрутов</span> <strong class="svelte-nxslby"> </strong></div></div> <div class="stat-card currency svelte-nxslby"><img class="stat-icon svelte-nxslby" alt="Иконка золота" loading="lazy"/> <div class="stat-body svelte-nxslby"><span class="label svelte-nxslby">Потрачено золота</span> <strong class="svelte-nxslby"> </strong></div></div> <div class="stat-card currency svelte-nxslby"><img class="stat-icon svelte-nxslby" alt="Иконка золота" loading="lazy"/> <div class="stat-body svelte-nxslby"><span class="label svelte-nxslby">Выиграно золота</span> <strong class="svelte-nxslby"> </strong></div></div> <div class="stat-card currency svelte-nxslby"><img class="stat-icon svelte-nxslby" alt="Иконка серебра" loading="lazy"/> <div class="stat-body svelte-nxslby"><span class="label svelte-nxslby">Выиграно серебра</span> <strong class="svelte-nxslby"> </strong></div></div> <div><img class="stat-icon svelte-nxslby" alt="Иконка золота" loading="lazy"/> <div class="stat-body svelte-nxslby"><span class="label svelte-nxslby">Чистый результат</span> <strong class="svelte-nxslby"> </strong></div></div></section> <section class="results-grid svelte-nxslby"><div class="panel svelte-nxslby"><h3 class="svelte-nxslby">Статистика призов</h3> <div class="table svelte-nxslby"><div class="table-row head svelte-nxslby"><span class="svelte-nxslby">Награда</span> <span class="svelte-nxslby">Выпало</span> <span class="svelte-nxslby">Всего ресурсов</span></div> <!></div></div> <div class="panel svelte-nxslby"><h3 class="svelte-nxslby">Последние выигрыши</h3> <!></div></section> <button class="primary modal-close-bottom svelte-nxslby">Закрыть</button></div></div>'),be=z('<li class="svelte-nxslby"><span class="odds-name svelte-nxslby"><img class="odds-icon svelte-nxslby" loading="lazy"/> <span class="name svelte-nxslby"> </span></span> <span class="chance svelte-nxslby"> </span></li>'),ye=z('<p class="odds-caption svelte-nxslby">Вероятность выпадения каждого приза на один прокрут.</p> <ul class="odds-list svelte-nxslby"></ul>',1),me=z('<div class="machine-shell svelte-nxslby"><div class="machine-body svelte-nxslby"><div class="machine-header svelte-nxslby"><span class="machine-tag svelte-nxslby">Золотая рулетка</span> <h2 class="svelte-nxslby"> </h2> <p class="svelte-nxslby"> </p></div> <form class="control-panel svelte-nxslby" style="order: -1;"><label class="input-group svelte-nxslby"><span class="svelte-nxslby">Бюджет золота</span> <div class="input-wrapper svelte-nxslby"><input type="number" aria-describedby="budget-hint" class="svelte-nxslby"/> <span class="suffix svelte-nxslby">золота</span></div> <small id="budget-hint" class="svelte-nxslby"> </small></label> <div class="actions svelte-nxslby"><button type="submit" class="primary svelte-nxslby"> </button> <button type="button"> </button></div> <!> <!></form> <!></div> <!> <aside><button class="odds-toggle svelte-nxslby"><div class="odds-toggle__title svelte-nxslby"><h3 class="svelte-nxslby">Теоретические шансы</h3> <span class="badge badge--small svelte-nxslby"> </span></div> <span class="chevron svelte-nxslby"> </span></button> <!></aside></div>');function ze(t,d){jt(d,!1);let v=Ft(d,"machine",8);const m=v().cost,b=v().rewards.filter(n=>n.odds>0).map(n=>te(n,v())).sort((n,i)=>i.chance-n.chance);let h=M(1e3),f=M(!1),_=M(null),r=M(null);const S=vs("hardcurrency"),R=vs("softcurrency");function T(n){return n==="hardcurrency"?"золота":n==="softcurrency"?"серебра":""}function L(n,i){const g=T(i);return g?`${p(n)} ${g}`:p(n)}let E=M(!1),as=M([]),P=M([]),G=M(0),$=null,X=M(0),Y=M(0),N=M(!1);function lt(){$&&($.abort(),$=null),o(r,null),o(as,[]),o(P,[]),o(G,0),o(X,0),o(_,null),o(Y,0),o(N,!1)}function ls(){o(N,!1)}function Bs(){$&&($.abort(),$=null)}async function nt(){o(_,null);const n=Math.floor(s(h)/m);if(s(h)<=0){o(_,"Введите положительное количество золота.");return}if(n<=0){o(_,`Недостаточно золота. Нужен минимум ${m} золота.`);return}o(r,null),o(as,[]),o(P,[]),o(f,!0),o(G,0),o(X,n),$=new AbortController,await Gt();try{const i=await ne(n,v(),{historySize:12,batchSize:2e3,signal:$.signal,onProgress(g){o(Y,g),o(G,g/n)}});o(as,i.breakdown),o(r,{spins:n,budget:s(h),goldSpent:n*m,goldWon:i.goldWon,silverWon:i.silverWon,netGold:i.goldWon-n*m}),o(P,i.history),o(N,!0)}catch(i){i instanceof DOMException&&i.name==="AbortError"?o(_,"Симуляция остановлена."):o(_,"Не удалось выполнить симуляцию. Попробуйте снова.")}finally{$=null,o(f,!1),o(G,0),o(X,0),o(Y,0)}}Bt(()=>{Bs()}),Ut();var us=me(),ps=a(us),bs=a(ps),ys=l(a(bs),2),rt=a(ys,!0);e(ys);var Cs=l(ys,2),ot=a(Cs);e(Cs),e(bs);var ns=l(bs,2),ms=a(ns),fs=l(a(ms),2),hs=a(fs);At(hs),Jt(2),e(fs);var js=l(fs,2),it=a(js);e(js),e(ms);var _s=l(ms,2),rs=a(_s),ct=a(rs,!0);e(rs);var os=l(rs,2),dt=a(os,!0);e(os),e(_s);var Js=l(_s,2);{var vt=n=>{var i=re(),g=a(i),U=a(g);e(g);var w=l(g,2),A=a(w);e(w),e(i),H((B,D,F,Z)=>{Dt(U,B),u(A,`Выполнено ${D??""}% — ${F??""} из
            ${Z??""} прокрутов`)},[()=>(s(G),c(()=>`width: ${Math.min(s(G)*100,100)}%`)),()=>(s(G),c(()=>Math.min(Math.floor(s(G)*100),100))),()=>(J(p),s(Y),c(()=>p(s(Y)))),()=>(J(p),s(X),c(()=>p(s(X))))]),W(n,i)};Q(Js,n=>{s(f)&&n(vt)})}var ut=l(Js,2);{var pt=n=>{var i=oe(),g=a(i,!0);e(i),H(()=>u(g,s(_))),W(n,i)};Q(ut,n=>{s(_)&&n(pt)})}e(ns);var bt=l(ns,2);{var yt=n=>{var i=ie();O("click",i,()=>o(N,!0)),W(n,i)};Q(bt,n=>{s(r)&&!s(N)&&n(yt)})}e(ps);var Es=l(ps,2);{var mt=n=>{var i=pe(),g=a(i),U=a(g),w=l(a(U),2);e(U);var A=l(U,2),B=a(A),D=l(a(B),2),F=l(a(D),2),Z=a(F,!0);e(F),e(D),e(B);var V=l(B,2),cs=a(V),ds=l(cs,2),Ts=l(a(ds),2),xt=a(Ts,!0);e(Ts),e(ds),e(V);var ws=l(V,2),Ls=a(ws),Us=l(Ls,2),Fs=l(a(Us),2),wt=a(Fs,!0);e(Fs),e(Us),e(ws);var Ss=l(ws,2),Hs=a(Ss),Ps=l(Hs,2),Ns=l(a(Ps),2),St=a(Ns,!0);e(Ns),e(Ps),e(Ss);var ks=l(Ss,2),Vs=a(ks),qs=l(Vs,2),Ks=l(a(qs),2),kt=a(Ks);e(Ks),e(qs),e(ks),e(A);var Is=l(A,2),Ws=a(Is),Qs=l(a(Ws),2),It=l(a(Qs),2);$s(It,1,()=>s(as),Ys,(k,y)=>{var C=ce(),x=a(C),j=a(x),q=l(j,2),ss=a(q,!0);e(q),e(x);var K=l(x,2),Ms=a(K);e(K);var ts=l(K,2),zs=a(ts,!0);e(ts),e(C),H((Rs,$t)=>{I(j,"src",(s(y),c(()=>s(y).icon))),I(j,"alt",(s(y),c(()=>s(y).label))),u(ss,(s(y),c(()=>s(y).label))),u(Ms,`x${Rs??""}`),u(zs,$t)},[()=>(J(p),s(y),c(()=>p(s(y).count))),()=>(s(y),c(()=>L(s(y).totalAmount,s(y).reward.type)))]),W(k,C)}),e(Qs),e(Ws);var Xs=l(Ws,2),Wt=l(a(Xs),2);{var Mt=k=>{var y=de();W(k,y)},zt=k=>{var y=ue();$s(y,5,()=>s(P),C=>C.timestamp,(C,x)=>{var j=ve(),q=a(j),ss=a(q),K=l(ss,2),Ms=a(K,!0);e(K),e(q);var ts=l(q,2),zs=a(ts);e(ts),e(j),H(Rs=>{I(ss,"src",(s(x),c(()=>s(x).icon))),I(ss,"alt",(s(x),c(()=>s(x).label))),u(Ms,(s(x),c(()=>s(x).label))),u(zs,`+${Rs??""}`)},[()=>(s(x),c(()=>L(s(x).reward.amount,s(x).reward.type)))]),W(C,j)}),e(y),W(k,y)};Q(Wt,k=>{s(P),c(()=>s(P).length===0)?k(Mt):k(zt,!1)})}e(Xs),e(Is);var Rt=l(Is,2);e(g),e(i),H((k,y,C,x,j)=>{u(Z,k),I(cs,"src",S),u(xt,y),I(Ls,"src",S),u(wt,C),I(Hs,"src",R),u(St,x),As(ks,1,(s(r),c(()=>`stat-card currency net ${s(r).netGold>=0?"positive":"negative"}`)),"svelte-nxslby"),I(Vs,"src",S),u(kt,`${s(r),c(()=>s(r).netGold>=0?"+":"")??""}${j??""}`)},[()=>(J(p),s(r),c(()=>p(s(r).spins))),()=>(J(p),s(r),c(()=>p(s(r).goldSpent))),()=>(J(p),s(r),c(()=>p(s(r).goldWon))),()=>(J(p),s(r),c(()=>p(s(r).silverWon))),()=>(J(p),s(r),c(()=>p(s(r).netGold)))]),O("click",w,ls),O("click",Rt,ls),O("click",i,Lt(ls)),O("keydown",i,k=>k.key==="Escape"&&ls()),W(n,i)};Q(Es,n=>{s(r)&&s(N)&&n(mt)})}var gs=l(Es,2);let Gs;var is=a(gs),xs=a(is),Ds=l(a(xs),2),ft=a(Ds);e(Ds),e(xs);var Os=l(xs,2),ht=a(Os,!0);e(Os),e(is);var _t=l(is,2);{var gt=n=>{var i=ye(),g=l(Et(i),2);$s(g,5,()=>b,Ys,(U,w)=>{var A=be(),B=a(A),D=a(B),F=l(D,2),Z=a(F,!0);e(F),e(B);var V=l(B,2),cs=a(V);e(V),e(A),H(ds=>{I(D,"src",(s(w),c(()=>s(w).icon))),I(D,"alt",(s(w),c(()=>s(w).label))),u(Z,(s(w),c(()=>s(w).label))),u(cs,`${ds??""}%`)},[()=>(s(w),c(()=>(s(w).chance*100).toFixed(4)))]),W(U,A)}),e(g),W(n,i)};Q(_t,n=>{s(E)&&n(gt)})}e(gs),e(us),H(()=>{u(rt,(J(v()),c(()=>v().title))),u(ot,`Стоимость прокрута — ${m??""} золота. Выберите бюджет и посмотрите, какие призы можно собрать.`),I(hs,"min",m),u(it,`Минимум ${m??""} — стоимость одного прокрута.`),rs.disabled=s(f),u(ct,s(f)?"Считаем…":"Запустить симуляцию"),As(os,1,`ghost ${s(f)?"danger":""}`,"svelte-nxslby"),u(dt,s(f)?"Остановить":"Очистить"),Gs=As(gs,1,"odds-panel svelte-nxslby",null,Gs,{collapsed:!s(E)}),u(ft,`${c(()=>b.length)??""} призов`),u(ht,s(E)?"▼":"▲")}),Ot(hs,()=>s(h),n=>o(h,n)),O("click",os,function(...n){(s(f)?Bs:lt)?.apply(this,n)}),O("submit",ns,Tt(nt)),O("click",is,()=>o(E,!s(E))),W(t,us),Ct()}export{ze as default};
