---
import BaseLayout from '@/layouts/BaseLayout.astro';
import MutantsBrowser from '@/components/MutantsBrowser.svelte';

import normal   from '@/data/mutants/normal.json';
import bronze   from '@/data/mutants/bronze.json';
import silver   from '@/data/mutants/silver.json';
import gold     from '@/data/mutants/gold.json';
import platinum from '@/data/mutants/platinum.json';

// Смешиваем обычных + все звёздные в один пул.
// Фильтр по звёздам в компоненте покажет «Обычные» по умолчанию.
const items = [...normal, ...bronze, ...silver, ...gold, ...platinum];

// Универсальный сбор ключей бинго (строки / объекты / словарь)
const collectBingoKeys = (it) => {
  const b = it?.bingo;
  if (!b) return [];
  if (Array.isArray(b)) return b.map(x => typeof x === 'string' ? x : (x?.key ?? '')).filter(Boolean);
  if (typeof b === 'object') return Object.keys(b);
  return [];
};

// Индекс бинго: берём из normal + звёздных (на случай, если где-то не пусто)
const bingoIndex = Array.from(new Set([...normal, ...items].flatMap(collectBingoKeys)));

export const prerender = true;
---

<BaseLayout>
  <!-- Включаем гидрацию и пробрасываем индекс бинго -->
  <MutantsBrowser client:load items={items} title="Мутанты" bingoIndex={bingoIndex} />
</BaseLayout>
