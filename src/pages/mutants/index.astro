---
import BaseLayout from '@/layouts/BaseLayout.astro';
import MutantsBrowser from '@/components/MutantsBrowser.svelte';

import mutants from '@/data/mutants/mutants.json';
import skins  from '@/data/mutants/skins.json';
import bingos from '@/data/bingos.json';

// Универсальный сбор ключей бинго
const collectBingoKeys = (it) => {
  const b = it?.bingo;
  if (!b) return [];
  if (Array.isArray(b)) return b.map(x => typeof x === 'string' ? x : (x?.key ?? '')).filter(Boolean);
  if (typeof b === 'object') return Object.keys(b);
  return [];
};

const bingoIndex = Array.from(new Set(
  [...mutants, ...(skins?.specimens ?? [])]
    .flatMap(collectBingoKeys)
));

export const prerender = true;
---

<BaseLayout>
  <MutantsBrowser
    client:load
    items={mutants}
    skins={skins?.specimens ?? []}
    bingos={bingos}
    title="Мутанты"
    bingoIndex={bingoIndex}
  />
</BaseLayout>
