---
import BaseLayout from '@/layouts/BaseLayout.astro';
import MutantsBrowser from '@/components/MutantsBrowser.svelte';

import normal   from '@/data/mutants/normal.json';
import bronze   from '@/data/mutants/bronze.json';
import silver   from '@/data/mutants/silver.json';
import gold     from '@/data/mutants/gold.json';
import platinum from '@/data/mutants/platinum.json';
import skins    from '@/data/mutants/skins.json';

// Пул по умолчанию: обычные + все звёздные.
// Фильтр по звёздам в компоненте изначально включён на "normal" (no_stars).
const items = [...normal, ...bronze, ...silver, ...gold, ...platinum];

// Универсальный сбор ключей бинго
const collectBingoKeys = (it) => {
  const b = it?.bingo;
  if (!b) return [];
  if (Array.isArray(b)) return b.map(x => typeof x === 'string' ? x : (x?.key ?? '')).filter(Boolean);
  if (typeof b === 'object') return Object.keys(b);
  return [];
};

// Индекс бинго: из normal + звёздных + (на будущее) из скинов
const bingoIndex = Array.from(new Set(
  [...normal, ...bronze, ...silver, ...gold, ...platinum, ...(skins?.specimens ?? [])]
    .flatMap(collectBingoKeys)
));

export const prerender = true;
---

<BaseLayout>
  <MutantsBrowser client:load items={items} skins={skins?.specimens ?? []} title="Мутанты" bingoIndex={bingoIndex} />
</BaseLayout>
